<!DOCTYPE html>
<html>

<head>
    <title>Arduino Microcontroller</title>
    <style>
        .toggle-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        .status-box {
            position: absolute;
            top: 55px;
            right: 10px;
            width: 20px;
            height: 20px;
            display: inline-block;
            margin-left: 10px;
            border: 1px solid black;
            transition: background-color 0.3s ease;
        }

        .status-on {
            background-color: green;
        }

        .status-off {
            background-color: red;
        }

        #led-status {
            position: absolute;
            top: 40px;
            right: 35px;
            font-size: 16px;
            color: black;
        }

        p {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h4>Arduino Temperature</h4>
    <p>Temperature: {{ temperatura }}&deg;C</p>

    <button class="toggle-button" onclick="toggleLED()">Toggle LED</button>
    <p id="led-status">LED is {% if led_state %}ON{% else %}OFF{% endif %}</p>
    <div id="status-box" class="status-box {% if led_state %}status-on{% else %}status-off{% endif %}"></div>

    <h4>Enter your message to send to the microcontroller</h4>
    <form action="/send_message" method="post">
        <input type="text" id="message" name="message">
        <button type="submit">Send</button>
    </form>

    <h4>Last 10 Messages</h4>
    <ul>
        {% for message in messages %}
            <li>
                {{ message }}
                {% if message.strip() != '' %}
                    <form action="/delete_message/{{ loop.index0 }}" method="post" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h4>Last 10 Water Sensor Messages</h4>
    <ul class="water-levels-list">
        {% for water_level in water_levels %}
            <li>
                {{ water_level }}
                {% if water_level.strip() != '' %}
                    <form action="/delete_water_message/{{ loop.index0 }}" method="post" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <script>
        function toggleLED() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("status-box").className = "status-box " + this.responseText;
                    document.getElementById("led-status").innerText = "LED is " + (this.responseText === "status-on" ? "ON" : "OFF");
                }
            };
            xhttp.open("POST", "/toggle_led", true);
            xhttp.send();
        }

        function updateWaterSensor() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var response = JSON.parse(this.responseText);
                    console.log("Updated water sensor value: " + response.water_sensor_value);
                    // Optionally update the web page with the new water sensor value
                }
            };
            xhttp.open("GET", "/update_water_sensor", true);
            xhttp.send();
        }

        setInterval(updateWaterSensor, 5000);  // Update water sensor every 5 seconds
    </script>

</body>

</html>
